{
  "name": "agente_whapp_v2",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "agente_whapp_v2",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -1568,
        -400
      ],
      "id": "f02b9a12-4a58-4306-b507-18cb0b3824cb",
      "name": "Webhook",
      "webhookId": "5ed27315-9eb9-4d7a-931d-4a9f08ec2703"
    },
    {
      "parameters": {
        "jsCode": "// Capturamos el body que viene como string de AWS\nconst rawBody = $node[\"Llama al motor de riesgo\"].json.body;\n\n// Lo transformamos de texto a objeto JSON real\nconst data = typeof rawBody === 'string' ? JSON.parse(rawBody) : rawBody;\n\n// Devolvemos solo lo que nos importa para el bot\nreturn {\n    dictamen: data.dictamen,\n    motivo: data.motivo,\n    score: data.score,\n    nombre: data.nombre,\n    apellido: data.apellido,\n    cuil: data.cuil\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        192,
        -544
      ],
      "id": "f3244bcb-8497-4a67-a39f-3e5d7351870a",
      "name": "Parsear Scoring"
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "=1002878796242815",
        "recipientPhoneNumber": "={{$node[\"Code in JavaScript1\"].json.sender}}",
        "textBody": "={{ \n  (() => {\n    // 1. Si existe respuesta de la l√≥gica de aprobaci√≥n (rama exitosa)\n    try {\n      const msgAprobado = $node[\"Logica Seguimiento\"].json.reply;\n      if (msgAprobado) return msgAprobado;\n    } catch (e) {}\n    \n    // 2. Si hubo un rechazo (rama falsa del If1)\n    try {\n      const scoring = $node[\"Parsear Scoring\"].json;\n      if (scoring.dictamen === \"Rechazar\") {\n        return \"Lo sentimos, por ahora no calific√°s. Motivo: \" + (scoring.motivo || \"Pol√≠tica de riesgo\");\n      }\n    } catch (e) {}\n    \n    // 3. Fallback: El flujo normal de preguntas (DNI, Email, etc.)\n    return $node[\"Detectar derivaci√≥n\"].json.reply;\n  })()\n}}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1.1,
      "position": [
        3888,
        80
      ],
      "id": "ce66943b-440e-4c2a-898e-5f89921ea30c",
      "name": "Send message",
      "webhookId": "04789d67-b70a-440c-961d-e9414e385279",
      "credentials": {
        "whatsAppApi": {
          "id": "cM3BoTKANHeRzXyl",
          "name": "WhatsApp account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT paso, datos_json, updated_at, conversation_id\nFROM sesiones_leads\nWHERE session_id = '{{ $node[\"Code in JavaScript1\"].json.sender }}'\nLIMIT 1;",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        -976,
        -400
      ],
      "id": "03c075e7-d209-4770-98e5-8ccd6a1b909a",
      "name": "Buscar sesi√≥n",
      "alwaysOutputData": true,
      "credentials": {
        "mySql": {
          "id": "SF2zqWk3cK4Rmcee",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// =========================\n// BOT WHATSAPP - LOGICA PRINCIPAL (n8n Code node)\n// =========================\n\n// 1. Datos de entrada (WhatsApp)\nconst filtroWA = $node[\"Extrae texto y sender\"].json;\nconst userInput = (filtroWA.chatInput || \"\").trim();\nconst sessionId = filtroWA.sender;\n\n// 2. Datos de la DB (viene del SELECT)\nconst dbResult = $json;\n\n// 3. Inicializar Estado\nlet currentStep = dbResult.paso ? parseInt(dbResult.paso) : 1;\nlet currentData = dbResult.datos_json\n  ? (typeof dbResult.datos_json === \"string\" ? JSON.parse(dbResult.datos_json) : dbResult.datos_json)\n  : {};\n\nlet responseMsg = \"\";\nlet isFinal = false;\n\n// 4. L√≥gica Conversacional\nif (userInput.toLowerCase() === \"reset\") {\n  currentStep = 1;\n  currentData = {};\n  responseMsg = \"Reiniciado. Envi√° cualquier mensaje para empezar.\";\n} else {\n  switch (currentStep) {\n    case 1:\n      currentStep = 2;\n      responseMsg = \"¬°Hola! Bienvenido a Gurpi. Por favor envi√° tu DNI (solo n√∫meros):\";\n      break;\n\n    case 2:\n      if (!/^\\d{7,9}$/.test(userInput)) {\n        responseMsg = \"DNI inv√°lido. Envi√° entre 7 y 9 n√∫meros:\";\n      } else {\n        currentData.documento = userInput;\n        currentStep = 3;\n        responseMsg = \"Gracias. Decime tu sexo (F o M):\";\n      }\n      break;\n\n    case 3:\n      if (!/^[FM]$/i.test(userInput)) {\n        responseMsg = \"Por favor, ingres√° solo 'F' o 'M':\";\n      } else {\n        currentData.sexo = userInput.toUpperCase();\n        currentStep = 4;\n        responseMsg = \"Perfecto. Ahora enviame tu n√∫mero de tel√©fono:\";\n      }\n      break;\n\n    case 4: {\n      const phone = userInput.replace(/\\D/g, \"\");\n      if (phone.length < 10 || phone.length > 13) {\n        responseMsg = \"Tel√©fono inv√°lido. Por favor inclu√≠ el c√≥digo de √°rea:\";\n      } else {\n        currentData.telefono = phone;\n        currentStep = 5;\n        responseMsg = \"Por √∫ltimo, ¬øcu√°l es tu email?:\";\n      }\n      break;\n    }\n\n    case 5:\n      if (!/.+@.+\\..+/.test(userInput)) {\n        responseMsg = \"Email inv√°lido. Por favor, revisalo:\";\n      } else {\n        currentData.mail = userInput.toLowerCase();\n        currentStep = 6;\n\n        // OJO: ac√° vos dijiste que despu√©s de email pas√°s a \"procesando calificaci√≥n\"\n        // Si quer√©s que el bot NO quede como final ac√°, dejalo en false.\n        // Si tu flow efectivamente corta ac√° hasta que vuelva scoring, pod√©s poner true.\n        isFinal = true;\n\n        responseMsg = \"¬°Muchas gracias! Ya recibimos tus datos. Procesando calificaci√≥n...\";\n      }\n      break;\n\n    // =========================\n    // 6: Selecci√≥n de Moto (CORREGIDO A TUS 5 OPCIONES)\n    // =========================\n    case 6: {\n      const t = userInput.trim().toLowerCase();\n\n      // 6.1) Si manda n√∫mero 1..5\n      const n = (t.match(/\\b[1-5]\\b/) || [])[0];\n      if (n) {\n        const map = {\n          \"1\": \"Motomel Blitz Start\",\n          \"2\": \"Motomel Blitz Full\",\n          \"3\": \"Motomel S2\",\n          \"4\": \"Motomel Skua 150\",\n          \"5\": \"TVS Gama Alta (Raider/RTR)\",\n        };\n\n        currentData.modelo_interes = map[n];\n        currentStep = 7;\n        responseMsg = `Perfecto ‚úÖ Elegiste: ${map[n]}.\\n\\n¬øTe contactamos por ac√° o prefer√≠s una llamada?`;\n        break;\n      }\n\n      // 6.2) Si manda texto (modelo)\n      const norm = t\n        .normalize(\"NFD\")\n        .replace(/[\\u0300-\\u036f]/g, \"\") // saca tildes\n        .replace(/[^a-z0-9\\s]/g, \" \")    // limpia\n        .replace(/\\s+/g, \" \")\n        .trim();\n\n      const hasBlitz = /\\bblitz\\b/.test(norm);\n      const hasStart = /\\bstart\\b/.test(norm);\n      const hasFull = /\\bfull\\b/.test(norm);\n      const hasS2 = /\\bs2\\b/.test(norm);\n      const hasSkua = /\\bskua\\b/.test(norm);\n      const hasTvs = /\\btvs\\b/.test(norm) || /\\braider\\b/.test(norm) || /\\brtr\\b/.test(norm);\n\n      let modelo = \"\";\n\n      // Orden importante: primero Full/Start, luego gen√©rico Blitz\n      if (hasBlitz && hasStart) modelo = \"Motomel Blitz Start\";\n      else if (hasBlitz && hasFull) modelo = \"Motomel Blitz Full\";\n      else if (hasS2) modelo = \"Motomel S2\";\n      else if (hasSkua) modelo = \"Motomel Skua 150\";\n      else if (hasTvs) modelo = \"TVS Gama Alta (Raider/RTR)\";\n      else if (hasBlitz) {\n        responseMsg = \"¬øBlitz Start (1) o Blitz Full (2)? Respond√© 1 o 2.\";\n        break;\n      }\n\n      if (modelo) {\n        currentData.modelo_interes = modelo;\n        currentStep = 7;\n        responseMsg = `Perfecto ‚úÖ Elegiste: ${modelo}.\\n\\n¬øTe contactamos por ac√° o prefer√≠s una llamada?`;\n      } else {\n        responseMsg =\n          \"No pude identificar el modelo. Respond√© con 1..5 o escrib√≠ el modelo (Blitz Start/Full, S2, Skua, TVS).\";\n      }\n      break;\n    }\n\n    case 7:\n      responseMsg = \"Perfecto, un asesor se pondr√° en contacto pronto. ¬°Gracias!\";\n      currentStep = 8;\n      break;\n\n    default:\n      responseMsg = \"Tu solicitud est√° en proceso.\";\n  }\n}\n\n// 5. Retorno (lo que consumen los nodos siguientes: SQL upsert + send message)\nreturn {\n  reply: responseMsg,\n  nextStep: currentStep,\n  datosActualizados: JSON.stringify(currentData),\n  sessionId: sessionId,\n\n  isFinal: isFinal,\n\n  // Mantengo tus campos extra\n  IDLead: sessionId,\n  documento: currentData.documento || \"\",\n  sexo: currentData.sexo || \"\",\n  telefono: currentData.telefono || \"\",\n  mail: currentData.mail || \"\",\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -656,
        -384
      ],
      "id": "ea00645f-af90-4c11-848f-44bd46c425b1",
      "name": "Paso 1 a 8"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO sesiones_leads (session_id, paso, datos_json, conversation_id, updated_at)\nVALUES (\n  '{{ $node[\"Code in JavaScript1\"].json.sender }}',\n  {{ $json.nextStep }},\n  '{{ $json.datosActualizados }}',\n  1,\n  NOW()\n)\nON DUPLICATE KEY UPDATE\n  conversation_id = IF(TIMESTAMPDIFF(DAY, updated_at, NOW()) >= 3, conversation_id + 1, conversation_id),\n  paso           = IF(TIMESTAMPDIFF(DAY, updated_at, NOW()) >= 3, 1, VALUES(paso)),\n  datos_json     = IF(TIMESTAMPDIFF(DAY, updated_at, NOW()) >= 3, '{}', VALUES(datos_json)),\n  updated_at     = NOW();\n",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        -416,
        -416
      ],
      "id": "be026480-9b05-4500-bb19-d3d043cd6cff",
      "name": "Guardar el estado",
      "alwaysOutputData": true,
      "credentials": {
        "mySql": {
          "id": "SF2zqWk3cK4Rmcee",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "4b00b5ad-2b29-47e1-b452-76f4db23a500",
              "leftValue": "={{ $('Paso 1 a 8').item.json.isFinal }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -240,
        -112
      ],
      "id": "ec097c25-ec03-461e-abd1-212edf614afe",
      "name": "Completo todos los datos?"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        1840,
        -592
      ],
      "id": "59249755-561e-41a1-8b78-143bc3d80282",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "RJTAsn6Cb7os9HQk",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const body = items[0].json.body;\nconst message = body.entry?.[0]?.changes?.[0]?.value?.messages?.[0];\n\nif (message && message.type === 'text') {\n  return {\n    chatInput: message.text.body,\n    sender: String(message.from).replace(/\\D/g, ''),\n    messageId: message.id\n  };\n} else {\n  // Si no es un mensaje de texto (ej. una notificaci√≥n de 'read'), detenemos el flujo\n  return []; \n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1216,
        -400
      ],
      "id": "8a7042d1-78f4-47df-8bf7-4589dbd19c80",
      "name": "Extrae texto y sender"
    },
    {
      "parameters": {
        "content": "## Recibe mensajes de wpp",
        "height": 240,
        "width": 272
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1648,
        -480
      ],
      "typeVersion": 1,
      "id": "ddee304f-c4c2-4222-ba48-83a9513c8303",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## Logica del BOT\nPASOS:\nPaso 1: Bienvenida\nPaso 2: Pide DNI\nPaso 3: Pide sexo (F/M)\nPaso 4: Pide tel√©fono\nPaso 5: Pide email\nPaso 6: Pide modelo de inter√©s\nPaso 7-8: Confirmaci√≥n",
        "height": 448,
        "width": 304
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -752,
        -592
      ],
      "typeVersion": 1,
      "id": "57e09c05-9ef9-4762-927e-9372fa841caa",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://nabvczi86h.execute-api.us-east-2.amazonaws.com/prod/politica_v2",
        "sendBody": true,
        "contentType": "=json",
        "specifyBody": "json",
        "bodyParameters": {
          "parameters": [
            {}
          ]
        },
        "jsonBody": "={{\n{\n  \"documento\": $node[\"Paso 1 a 8\"].json.documento,\n  \"sexo\": $node[\"Paso 1 a 8\"].json.sexo,\n  \"telefono\": $node[\"Paso 1 a 8\"].json.telefono,\n  \"mail\": $node[\"Paso 1 a 8\"].json.mail,\n  \"IDLead\": $node[\"Paso 1 a 8\"].json.sessionId,\n  \"session_id\": $node[\"Paso 1 a 8\"].json.sessionId,\n  \"utm_campaign\": \"\",\n  \"utm_source\": \"n8n_bot_fintech\",\n  \"utm_medium\": \"\",\n  \"utm_term\": \"\",\n  \"utm_content\": \"\",\n  \"codigo_referido\": \"\"\n}\n}}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -96,
        -512
      ],
      "id": "265dd8dd-793f-4936-a89a-be17b43857e5",
      "name": "Llama al motor de riesgo"
    },
    {
      "parameters": {
        "content": "## Extrae score, motivo\n",
        "height": 192,
        "width": 224
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        112,
        -624
      ],
      "typeVersion": 1,
      "id": "9cd3fe8d-5c3c-423b-9b8f-33d95ceed183",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "jsCode": "// Preparar contexto para el agente IA\nconst sessionData = $node[\"Buscar sesi√≥n\"].json[0] || {};\nconst scoringData = $node[\"Parsear Scoring\"].json;\nconst userMessage = $node[\"Code in JavaScript1\"].json.chatInput;\n\n// Parsear datos JSON si existen\nlet datosCapturados = {};\nif (sessionData.datos_json) {\n  datosCapturados = typeof sessionData.datos_json === 'string' \n    ? JSON.parse(sessionData.datos_json) \n    : sessionData.datos_json;\n}\n\n// Calcular d√≠as de inactividad\nlet diasInactivo = 0;\nif (sessionData.updated_at) {\n  const lastUpdate = new Date(sessionData.updated_at);\n  const now = new Date();\n  diasInactivo = Math.floor((now - lastUpdate) / (1000 * 60 * 60 * 24));\n}\n\n// Preparar contexto personalizado\nlet contextoUsuario = \"\";\n\nif (!sessionData.session_id) {\n  // Usuario nuevo\n  contextoUsuario = `Usuario NUEVO. Acaba de ser aprobado por el motor de riesgo.\nScore: ${scoringData.score}\nNombre: ${scoringData.nombre} ${scoringData.apellido}\nCUIL: ${scoringData.cuil}\n\nEste es su primer contacto despu√©s de la aprobaci√≥n.`;\n  \n} else if (diasInactivo < 3) {\n  // Usuario que vuelve pronto\n  contextoUsuario = `Usuario ACTIVO (√∫ltima interacci√≥n hace ${diasInactivo === 0 ? 'hoy' : diasInactivo + ' d√≠as'}).\n\nDatos previos:\n- Modelo de inter√©s: ${datosCapturados.modelo_interes || 'No especificado a√∫n'}\n- Paso actual: ${sessionData.paso_actual || 'conversando'}\n\nContin√∫a la conversaci√≥n desde donde qued√≥.`;\n  \n} else {\n  // Usuario inactivo\n  contextoUsuario = `Usuario INACTIVO (${diasInactivo} d√≠as sin escribir).\n\n√öltima vez ten√≠a inter√©s en: ${datosCapturados.modelo_interes || 'no especificado'}\n\nMencion√° que hablaron antes y pregunt√° si quiere continuar con lo mismo.`;\n}\n\nreturn {\n  json: {\n    // Datos para el agente\n    session_id: $node[\"Code in JavaScript1\"].json.sender,\n    conversation_id: sessionData.conversation_id || '1',\n    user_message: userMessage,\n    contexto_usuario: contextoUsuario,\n    \n    // Datos del scoring\n    nombre: scoringData.nombre,\n    apellido: scoringData.apellido,\n    cuil: scoringData.cuil,\n    scoring_score: scoringData.score,\n    \n    // Datos capturados\n    documento: datosCapturados.documento,\n    sexo: datosCapturados.sexo,\n    telefono: datosCapturados.telefono,\n    mail: datosCapturados.mail,\n    modelo_interes: datosCapturados.modelo_interes,\n    \n    // Estado\n    scoring_aprobado: true,\n    dias_inactivo: diasInactivo\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        496,
        -672
      ],
      "id": "cf42b043-bb8f-4179-95a8-d5811f94227b",
      "name": "Preparar contexto IA"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT rol, contenido, created_at\nFROM mensajes\nWHERE session_id = '{{ $json.session_id }}'\n  AND conversation_id = '{{ $json.conversation_id }}'\nORDER BY created_at ASC\nLIMIT 20;",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        912,
        -704
      ],
      "id": "b9aff213-85b7-46ab-bd74-2c9c48adf30f",
      "name": "Recuperar Historial de Mensajes"
    },
    {
      "parameters": {
        "jsCode": "// Convertir historial MySQL a formato GPT messages\nconst historial = $node[\"Recuperar Historial Mensajes\"].json || [];\nconst contexto = $node[\"Preparar Contexto GIA\"].json;\n\n// Construir array de mensajes para GPT\nlet messages = [];\n\n// Agregar contexto como system message\nmessages.push({\n  role: \"system\",\n  content: contexto.contexto_usuario\n});\n\n// Agregar historial previo (√∫ltimos 10 mensajes para no saturar)\nhistorial.slice(-10).forEach(msg => {\n  messages.push({\n    role: msg.rol,\n    content: msg.contenido\n  });\n});\n\n// Agregar mensaje actual del usuario\nmessages.push({\n  role: \"user\",\n  content: contexto.user_message\n});\n\nreturn {\n  json: {\n    ...contexto,\n    messages: messages,\n    historial_length: historial.length\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1328,
        -752
      ],
      "id": "62d86aee-d10d-498a-85c7-6c93410013b5",
      "name": "Formatear Historial para GPT"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "Eres GIA, la asistente virtual de Gurpi.\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nCONTEXTO IMPORTANTE:\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nEste usuario:\n‚úÖ YA fue APROBADO por el motor de riesgo (scoring)\n‚úÖ YA eligi√≥ un modelo de moto/auto inicial\n‚úÖ YA recibi√≥ el cat√°logo en PDF\n\nTu trabajo es:\n1. Responder sus dudas sobre el modelo, precios y proceso\n2. Ayudarlo a tomar la decisi√≥n final\n3. Guiarlo hacia el siguiente paso (cita o transferencia)\n4. Derivar a humano cuando sea necesario\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nCAT√ÅLOGO DE PRODUCTOS (Enero 2025)\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nMOTOS:\n\n1. Motomel Blitz Start\n   ‚Ä¢ Se√±a: $35.000\n   ‚Ä¢ Anticipo: $190.000\n   ‚Ä¢ Cuota semanal: $69.999\n   ‚Ä¢ Plazo: 52 semanas (1 a√±o)\n   ‚Ä¢ Ideal para: Comenzar en delivery\n\n2. Motomel Blitz Full\n   ‚Ä¢ Se√±a: $35.000\n   ‚Ä¢ Anticipo: $350.000\n   ‚Ä¢ Cuota semanal: $69.999\n   ‚Ä¢ Plazo: 52 semanas (1 a√±o)\n   ‚Ä¢ Versi√≥n full de la Blitz\n\n3. Motomel S2\n   ‚Ä¢ Se√±a: $35.000\n   ‚Ä¢ Anticipo: $450.000\n   ‚Ä¢ Cuota semanal: $79.999\n   ‚Ä¢ Plazo: 52 semanas (1 a√±o)\n   ‚Ä¢ Moto robusta y confiable\n\n4. Motomel Skua 150 - TRES PLANES:\n   \n   Plan A (1 a√±o):\n   ‚Ä¢ Se√±a: $35.000\n   ‚Ä¢ Anticipo: $590.000\n   ‚Ä¢ Cuota semanal: $83.000\n   ‚Ä¢ Plazo: 52 semanas\n   \n   Plan B (1.5 a√±os):\n   ‚Ä¢ Se√±a: $35.000\n   ‚Ä¢ Anticipo: $590.000\n   ‚Ä¢ Cuota semanal: $83.000\n   ‚Ä¢ Plazo: 78 semanas\n   \n   Plan C (2 a√±os):\n   ‚Ä¢ Se√±a: $35.000\n   ‚Ä¢ Anticipo: $590.000\n   ‚Ä¢ Cuota semanal: $90.000\n   ‚Ä¢ Plazo: 104 semanas\n\n5. TVS Raider 125\n   ‚Ä¢ Se√±a: $35.000\n   ‚Ä¢ Anticipo: $850.000\n   ‚Ä¢ Cuota semanal: $83.000\n   ‚Ä¢ Plazo: 78 semanas (1.5 a√±os)\n   ‚Ä¢ Gama alta\n\n6. TVS RTR 160 4V - DOS PLANES:\n   \n   Plan A (1.5 a√±os):\n   ‚Ä¢ Se√±a: $35.000\n   ‚Ä¢ Anticipo: $850.000\n   ‚Ä¢ Cuota semanal: $83.000\n   ‚Ä¢ Plazo: 78 semanas\n   \n   Plan B (2 a√±os):\n   ‚Ä¢ Se√±a: $35.000\n   ‚Ä¢ Anticipo: $1.500.000\n   ‚Ä¢ Cuota semanal: $83.000\n   ‚Ä¢ Plazo: 104 semanas\n\n7. TVS RTR 200 4V\n   ‚Ä¢ Se√±a: $35.000\n   ‚Ä¢ Anticipo: $2.000.000\n   ‚Ä¢ Cuota semanal: $90.000\n   ‚Ä¢ Plazo: 104 semanas (2 a√±os)\n   ‚Ä¢ Alta cilindrada\n\nAUTOS:\n\n8. Renault KWID\n   ‚Ä¢ Se√±a: $100.000\n   ‚Ä¢ Anticipo: $1.900.000\n   ‚Ä¢ Cuota semanal: $380.000\n   ‚Ä¢ Plazo: 156 semanas (3 a√±os)\n   ‚Ä¢ Auto naftero, incluye seguro\n   ‚Ä¢ Se le puede agregar GNC\n\n9. Renault LOGAN\n   ‚Ä¢ Se√±a: $100.000\n   ‚Ä¢ Anticipo: $3.700.000\n   ‚Ä¢ Cuota semanal: $380.000\n   ‚Ä¢ Plazo: 156 semanas (3 a√±os)\n   ‚Ä¢ Auto naftero sed√°n\n   ‚Ä¢ Se le puede agregar GNC\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nINFORMACI√ìN CLAVE DEL PROCESO\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nSEGUROS:\n- Incluido en la cuota: Seguro comercial\n- Cobertura: Robo total + Responsabilidad Civil\n- NO cubre: Da√±os parciales (choques, rayones, roturas)\n- Beneficiario: Gurpi (hasta completar el pago)\n\nGARANT√çA:\n- Tipo: Oficial del fabricante\n- Cobertura: Defectos de f√°brica y fallas mec√°nicas\n- Seg√∫n: Manual del veh√≠culo\n- Talleres: Indicados por Gurpi\n\nTIEMPOS DE ENTREGA:\n- Estimado: 20 a 30 d√≠as\n- Depende de: Llegada de patente y c√©dula\n- Color: Seg√∫n stock disponible (se elige al retirar)\n\nTRANSFERENCIA:\n- Cu√°ndo: Despu√©s de pagar la √∫ltima cuota\n- Costo: $1 (un peso) + gastos de transferencia\n- Hasta entonces: El veh√≠culo est√° en modalidad de alquiler\n- Propiedad: A nombre de Gurpi hasta completar el pago\n\nPAGOS:\n- D√≠a: Todos los jueves\n- Forma: Transferencia bancaria\n- Banco: Galicia\n- CBU: 0070675520000001513626\n- Alias: GURPI.LA\n- CUIT: 30-71781292-8\n- Titular: GURPI SA\n\nMORA:\n- Inter√©s punitorio: $1.500 por d√≠a de atraso\n- Se suma a las cuotas pendientes\n\nSUSPENSI√ìN DE PAGOS:\n- Disponible: Despu√©s de 3 meses con cuotas al d√≠a\n- M√°ximo: 2 cuotas\n- Se pagan antes de finalizar el contrato\n- Requiere autorizaci√≥n\n\nSUCURSALES:\n- Buenos Aires\n- C√≥rdoba\n- Rosario\n- Mendoza\n- Tucum√°n\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nC√ìMO RESPONDER\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nESTILO:\n- Tono: Amigable pero profesional\n- Voseo: Argentino neutro (vos/t√∫)\n- Extensi√≥n: Conciso pero completo\n- Emojis: M√°ximo 2-3 por mensaje\n- Formato: P√°rrafos cortos, f√°cil de leer en celular\n\nESTRUCTURA:\n1. Responder la pregunta directamente\n2. Agregar info relevante si es necesaria\n3. Preguntar si tiene m√°s dudas\n\nEJEMPLO BUENO:\nUsuario: \"¬øLa Blitz tiene garant√≠a?\"\nGIA: \"S√≠, la Blitz incluye garant√≠a oficial del fabricante. Cubre defectos de f√°brica y fallas mec√°nicas seg√∫n el manual.\n\n¬øQuer√©s saber algo m√°s del modelo?\"\n\nEJEMPLO MALO (muy largo):\n\"¬°Hola! Claro que s√≠, d√©jame contarte todo sobre la garant√≠a. La Motomel Blitz Start cuenta con una garant√≠a oficial proporcionada directamente por el fabricante Motomel, que es una de las marcas m√°s confiables de Argentina. Esta garant√≠a cubre espec√≠ficamente los defectos de f√°brica que puedan surgir durante el per√≠odo de cobertura, as√≠ como tambi√©n las fallas mec√°nicas que no sean producto del uso indebido o negligencia del conductor...\"\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nREGLAS CR√çTICAS - NUNCA HAGAS ESTO\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n‚ùå NO prometas fechas exactas de entrega\n   ‚úÖ Dec√≠: \"Entre 20 y 30 d√≠as aproximadamente\"\n\n‚ùå NO prometas colores espec√≠ficos\n   ‚úÖ Dec√≠: \"Seg√∫n stock disponible, lo eleg√≠s al retirar\"\n\n‚ùå NO prometas descuentos o cambios en precios\n   ‚úÖ Dec√≠: \"Los precios del cat√°logo son los vigentes\"\n\n‚ùå NO confirmes stock espec√≠fico\n   ‚úÖ Dec√≠: \"Un asesor te confirma disponibilidad\"\n\n‚ùå NO des informaci√≥n que no ten√©s\n   ‚úÖ Dec√≠: \"No tengo esa info, un asesor te ayuda ma√±ana en horario laboral (Lun-Vie 9-18hs)\"\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nAVANZAR HACIA LA COMPRA\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nCuando notes que el usuario:\n- Ya no tiene m√°s dudas importantes\n- Dice cosas como \"Dale, la quiero\" o \"Me convence\" o \"S√≠, vamos\"\n- Pregunta \"¬øY ahora qu√© sigue?\" o \"¬øC√≥mo sigo?\"\n\nEntonces presenta las 2 opciones:\n\n\"Perfecto! Para avanzar con tu [MODELO], ¬øc√≥mo prefer√≠s seguir?\n\n1Ô∏è‚É£ **Agendar una cita presencial**\n   Tenemos sucursales en Buenos Aires, C√≥rdoba, Rosario, Mendoza y Tucum√°n.\n   Pod√©s venir a conocer la moto o directamente a se√±arla.\n\n2Ô∏è‚É£ **Transferir la se√±a ahora**\n   Te paso los datos bancarios y coordinamos la entrega cuando est√© lista (20-30 d√≠as).\n\n¬øCu√°l prefer√≠s?\"\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nOPCI√ìN 1: AGENDAR CITA\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nSi elige agendar cita, pregunt√° en orden:\n\n1. \"¬øEn qu√© ciudad est√°s? Tenemos sucursales en:\n   ‚Ä¢ Buenos Aires\n   ‚Ä¢ C√≥rdoba\n   ‚Ä¢ Rosario\n   ‚Ä¢ Mendoza\n   ‚Ä¢ Tucum√°n\"\n\n2. \"¬øQu√© d√≠a y horario te viene bien?\n   Lun-Vie 9-18hs / S√°b 9-13hs\"\n\n3. \"¬øEs para conocer la moto en persona o para se√±arla directamente?\"\n\nCuando tengas los 3 datos:\n\n\"Listo! ‚úÖ Ya te anot√© para el [D√çA] en [CIUDAD] para [MOTIVO].\n\nUn asesor te va a contactar ma√±ana en horario laboral (Lun-Vie 9-18hs) para confirmar la cita y pasarte la direcci√≥n exacta.\n\n¬øAlguna duda m√°s por ahora?\"\n\nMarc√° internamente: CITA_AGENDADA\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nOPCI√ìN 2: TRANSFERIR SE√ëA\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nSi elige transferir, primero pregunt√°:\n\n\"¬øQuer√©s transferir solo la se√±a ($35.000 para motos / $100.000 para autos) para reservar la unidad, o el anticipo completo para agilizar?\"\n\nLuego envi√°:\n\n\"üì± **Datos para transferir:**\n\nüè¶ Banco: **Galicia**\nüí≥ CBU: `0070675520000001513626`\nüìñ Alias: `GURPI.LA`\nüìã CUIT: `30-71781292-8`\nüë§ Titular: **GURPI SA**\n\n**Montos para [MODELO]:**\n- Se√±a: **$[SE√ëA]** (para reservar tu unidad)\n- Anticipo total: **$[ANTICIPO]** (opcional, pod√©s pagarlo despu√©s)\n\n‚ö†Ô∏è **Importante:**\n- Cuando hagas la transferencia, enviame el comprobante ac√°\n- Con la se√±a reserv√°s tu unidad\n- El anticipo se paga cuando est√© lista para retirar (20-30 d√≠as)\n\n¬øTe queda alguna duda sobre los pagos?\"\n\nMarc√° internamente: DATOS_TRANSFERENCIA_ENVIADOS\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nDERIVACI√ìN A HUMANO\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nDERIV√Å INMEDIATAMENTE cuando:\n\n1. **Usuario env√≠a comprobante**\n   \"Perfecto! ‚úÖ Recib√≠ el comprobante.\n   \n   Un asesor lo va a verificar en horario laboral y te va a contactar para confirmar y coordinar los siguientes pasos.\n   \n   La moto tarda entre 20 a 30 d√≠as en estar lista (cuando llegue la patente y c√©dula).\n   \n   ¬øQuer√©s que te explique algo m√°s mientras tanto?\"\n   \n   Marc√°: COMPROBANTE_RECIBIDO\n\n2. **Usuario da 7 mensajes sin avanzar**\n   (Si hace 7+ preguntas pero no decide)\n   \"Te noto con muchas dudas, lo cual es totalmente normal para una compra importante como esta.\n   \n   ¬øTe gustar√≠a que un asesor te contacte para resolver todo en detalle? Pueden explicarte mejor todo el proceso.\"\n   \n   Marc√°: MUCHAS_DUDAS\n\n3. **Pregunta muy espec√≠fica que no pod√©s responder**\n   Ejemplos: problemas mec√°nicos, modificaciones, situaciones legales complejas\n   \n   \"Esa es una consulta m√°s espec√≠fica. Un asesor especializado te va a poder ayudar mejor con eso. Te contacto ma√±ana en horario laboral (Lun-Vie 9-18hs), ¬øte parece?\"\n   \n   Marc√°: CONSULTA_ESPECIALIZADA\n\n4. **Usuario expresa queja o frustraci√≥n**\n   \"Entiendo tu preocupaci√≥n. Un asesor te va a contactar lo antes posible para resolver esto. ¬øMe cont√°s m√°s detalles para que el equipo est√© al tanto?\"\n   \n   Marc√°: QUEJA_RECLAMO\n\n5. **Usuario solicita cita** (ya lo anotaste arriba)\n\nIMPORTANTE: Despu√©s de marcar derivaci√≥n, SIEMPRE segu√≠ respondiendo si el usuario hace m√°s preguntas. No te desconectes.\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nTONO Y PERSONALIDAD\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nS√â:\n- Paciente (es una compra grande, es normal tener dudas)\n- Claro (evit√° jerga t√©cnica innecesaria)\n- Honesto (si no sab√©s algo, decilo)\n- Proactivo (ofrec√© info relevante sin que la pidan)\n\nNO SEAS:\n- Rob√≥tico\n- Repetitivo\n- Insistente\n- Condescendiente\n\nEJEMPLOS DE BUEN TONO:\n\n\"La Blitz Start es perfecta para arrancar en delivery. Tiene buen rendimiento y es econ√≥mica de mantener.\"\n\n\"El seguro comercial que incluimos cubre robo total y responsabilidad civil. Los da√±os parciales (como rayones o roturas) no entran, por eso te recomendamos guardarla con candado en lugar seguro.\"\n\n\"Entre la Blitz y la S2, la diferencia principal es que la S2 es m√°s robusta y tiene mejor suspensi√≥n. Si vas a hacer muchos km por d√≠a, la S2 rinde mejor. Si es para distancias cortas, la Blitz te sobra.\"\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nRESUMEN DE TU MISI√ìN\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n1. ‚úÖ Responder dudas con info precisa del cat√°logo\n2. ‚úÖ Explicar el proceso de compra claramente\n3. ‚úÖ Ayudar a decidir entre modelos si pregunta\n4. ‚úÖ Guiar hacia cita o transferencia\n5. ‚úÖ Derivar a humano cuando corresponda\n6. ‚úÖ Ser amigable y profesional siempre\n\nRecord√°: Este usuario YA est√° aprobado y YA eligi√≥ un modelo inicial. Tu trabajo NO es vender desde cero, sino ayudarlo a finalizar su compra con confianza.\n\n¬°√âxito, GIA! üöÄ"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        1904,
        -880
      ],
      "id": "bbb802d7-e6c0-414a-9c1f-38dc676e4ec8",
      "name": "GIA"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        2016,
        -592
      ],
      "id": "f695ced1-08d7-418f-b63a-d9304db115aa",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO mensajes (session_id, conversation_id, rol, contenido, tipo_contenido, created_at)\nVALUES (\n  '{{ $node[\"Formatear Historial Chat\"].json.session_id }}',\n  '{{ $node[\"Formatear Historial Chat\"].json.conversation_id }}',\n  'user',\n  '{{ $node[\"Formatear Historial Chat\"].json.user_message }}',\n  'text',\n  NOW()\n);",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        2384,
        -864
      ],
      "id": "d7703eb5-1a6e-4f06-959a-861bf290b9d8",
      "name": "Guardar Respuesta IA"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE sesiones_leads\nSET \n  paso_actual = '{{ $json.accion_detectada }}',\n  derivado_a_humano = {{ $json.debe_derivar }},\n  motivo_derivacion = '{{ $json.motivo_derivacion }}',\n  mensajes_sin_avance = {{ $json.historial_length / 2 }},\n  updated_at = NOW()\nWHERE session_id = '{{ $json.session_id }}';",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        3216,
        -816
      ],
      "id": "f55410b9-08a1-4e7a-a85f-c831c9d5fb30",
      "name": "Actualizar Estado en MySQL"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "344ecb64-9715-4d13-900e-31bd3675520e",
              "leftValue": "={{ $json.debe_derivar }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        3600,
        -784
      ],
      "id": "ae28f7af-9491-4ca3-90ec-d6eda3e7cbf7",
      "name": "Derivar"
    },
    {
      "parameters": {
        "content": "Busca en la base de datos los ultimos 20 mensajes de la conversaci√≥n entre el usuario y GIA.",
        "height": 240,
        "width": 288
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        816,
        -768
      ],
      "typeVersion": 1,
      "id": "199911f2-dc43-4df0-adae-445bd13553ee",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "Recopila toda la informaci√≥n del usuario y la organiza para pas√°rsela al agente IA.",
        "height": 240,
        "width": 304
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        400,
        -768
      ],
      "typeVersion": 1,
      "id": "eaf91e46-c752-48f0-9e4c-4231a98fedca",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "content": "Convierte el historial de MySQL al formato que GPT-4 entiende (formato OpenAI messages).",
        "height": 272,
        "width": 256
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1264,
        -864
      ],
      "typeVersion": 1,
      "id": "854dd818-eaed-4d49-80f3-56beffdff54e",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "content": "Este es el cerebro. Lee toda la conversaci√≥n, el contexto del usuario, y genera la respuesta.",
        "height": 240,
        "width": 304
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1856,
        -960
      ],
      "typeVersion": 1,
      "id": "9d61b22f-1235-4429-8e65-f83a57515fce",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "jsCode": "const respuestaIA = $node[\"Agente IA GIA\"].json.output;\nconst mensajeUsuario = $node[\"Formatear Historial Chat\"].json.user_message;\nconst historialLength = $node[\"Formatear Historial Chat\"].json.historial_length;\n\nlet debeDeriva = false;\nlet motivoDerivacion = null;\nlet accionDetectada = \"conversando\";\nlet datosCapturados = {};\n\n// 1. Detectar si envi√≥ comprobante\nif (mensajeUsuario.toLowerCase().includes(\"comprobante\") ||\n    mensajeUsuario.toLowerCase().includes(\"transfer√≠\") ||\n    mensajeUsuario.toLowerCase().includes(\"pagu√©\") ||\n    respuestaIA.includes(\"COMPROBANTE_RECIBIDO\")) {\n  debeDeriva = true;\n  motivoDerivacion = \"Envi√≥ comprobante de pago\";\n  accionDetectada = \"comprobante_recibido\";\n}\n\n// 2. Detectar si agend√≥ cita\nelse if (respuestaIA.includes(\"CITA_AGENDADA\")) {\n  debeDeriva = true;\n  motivoDerivacion = \"Agend√≥ cita presencial\";\n  accionDetectada = \"cita_agendada\";\n  \n  // Extraer ciudad si est√° en la respuesta\n  const ciudades = [\"Buenos Aires\", \"C√≥rdoba\", \"Rosario\", \"Mendoza\", \"Tucum√°n\"];\n  for (const ciudad of ciudades) {\n    if (respuestaIA.includes(ciudad)) {\n      datosCapturados.ciudad_cita = ciudad;\n      break;\n    }\n  }\n}\n\n// 3. Detectar si pidi√≥ datos de transferencia\nelse if (respuestaIA.includes(\"DATOS_TRANSFERENCIA_ENVIADOS\")) {\n  accionDetectada = \"datos_transferencia_enviados\";\n}\n\n// 4. Detectar muchas dudas (7+ mensajes)\nelse if (historialLength >= 14) { // 7 del usuario + 7 respuestas = 14 total\n  debeDeriva = true;\n  motivoDerivacion = \"M√°s de 7 mensajes sin decidir\";\n  accionDetectada = \"muchas_dudas\";\n}\n\n// 5. Detectar consulta especializada\nelse if (respuestaIA.includes(\"CONSULTA_ESPECIALIZADA\")) {\n  debeDeriva = true;\n  motivoDerivacion = \"Consulta muy espec√≠fica\";\n  accionDetectada = \"consulta_especializada\";\n}\n\n// 6. Detectar queja\nelse if (respuestaIA.includes(\"QUEJA_RECLAMO\")) {\n  debeDeriva = true;\n  motivoDerivacion = \"Queja o reclamo\";\n  accionDetectada = \"queja_reclamo\";\n}\n\nreturn {\n  json: {\n    ...$node[\"Formatear Historial Chat\"].json,\n    respuesta_ia: respuestaIA,\n    debe_derivar: debeDeriva,\n    motivo_derivacion: motivoDerivacion,\n    accion_detectada: accionDetectada,\n    datos_capturados: datosCapturados\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2752,
        -864
      ],
      "id": "e240c004-9085-481c-ae90-c4b153dbdddf",
      "name": "Detectar derivaci√≥n"
    },
    {
      "parameters": {
        "content": "Palabras clave: \"comprobante\", \"transfer√≠\", \"pagu√©\"\nMarcadores en la respuesta de GIA: \"CITA_AGENDADA\", \"COMPROBANTE_RECIBIDO\"\nCantidad de mensajes: si hay 14+ (7 usuario + 7 GIA) = muchas dudas",
        "height": 352,
        "width": 336
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2640,
        -1008
      ],
      "typeVersion": 1,
      "id": "d8cacbb2-f9c4-49c9-b12c-1141d8ee673a",
      "name": "Sticky Note7"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        4096,
        -752
      ],
      "id": "a27c5902-c243-4dfb-b982-1a7a15cff27e",
      "name": "NOTIFICACI√ìN"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO prod_test.mensajes (session_id, conversation_id, rol, contenido, tipo_contenido, created_at)\nVALUES (\n  '{{ $json.session_id }}',\n  '{{ $json.conversation_id }}',\n  'user',\n  '{{ $json.user_message }}',\n  'text',\n  NOW()\n);",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        1600,
        -800
      ],
      "id": "3eac5f27-bb3b-4d99-9b17-d059ef8dcc10",
      "name": "Guardar mensaje usuario"
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "=1002878796242815",
        "recipientPhoneNumber": "={{$node[\"Code in JavaScript1\"].json.sender}}",
        "textBody": "={{ \n  (() => {\n    // Intentar obtener la respuesta de GIA\n    try {\n      const respuestaGIA = $node[\"Detectar Derivaci√≥n\"].json.respuesta_ia;\n      if (respuestaGIA) return respuestaGIA;\n    } catch (e) {}\n    \n    // Si no hay respuesta de GIA, usar la l√≥gica anterior\n    try {\n      const scoring = $node[\"Parsear Scoring\"].json;\n      if (scoring.dictamen === \"Rechazar\") {\n        return \"Lo sentimos, por ahora no calificas. Motivo: \" + (scoring.motivo || \"Pol√≠tica de riesgo\");\n      }\n    } catch (e) {}\n    \n    // Fallback: respuesta del bot original\n    return $node[\"Paso 1 a 8\"].json.reply;\n  })()\n}}\n",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1.1,
      "position": [
        4224,
        -144
      ],
      "id": "1f5b52e5-c40f-4522-a72e-d6ffb231ef32",
      "name": "Send message1",
      "webhookId": "04789d67-b70a-440c-961d-e9414e385279"
    }
  ],
  "pinData": {},
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Extrae texto y sender",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parsear Scoring": {
      "main": [
        [
          {
            "node": "Preparar contexto IA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar sesi√≥n": {
      "main": [
        [
          {
            "node": "Paso 1 a 8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Paso 1 a 8": {
      "main": [
        [
          {
            "node": "Guardar el estado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Guardar el estado": {
      "main": [
        [
          {
            "node": "Completo todos los datos?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Completo todos los datos?": {
      "main": [
        [
          {
            "node": "Llama al motor de riesgo",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "GIA",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Extrae texto y sender": {
      "main": [
        [
          {
            "node": "Buscar sesi√≥n",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Llama al motor de riesgo": {
      "main": [
        [
          {
            "node": "Parsear Scoring",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Preparar contexto IA": {
      "main": [
        [
          {
            "node": "Recuperar Historial de Mensajes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Recuperar Historial de Mensajes": {
      "main": [
        [
          {
            "node": "Formatear Historial para GPT",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Formatear Historial para GPT": {
      "main": [
        [
          {
            "node": "Guardar mensaje usuario",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GIA": {
      "main": [
        [
          {
            "node": "Guardar Respuesta IA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "GIA",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Guardar Respuesta IA": {
      "main": [
        [
          {
            "node": "Detectar derivaci√≥n",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar Estado en MySQL": {
      "main": [
        [
          {
            "node": "Derivar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Derivar": {
      "main": [
        [
          {
            "node": "NOTIFICACI√ìN",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send message1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Detectar derivaci√≥n": {
      "main": [
        [
          {
            "node": "Actualizar Estado en MySQL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Guardar mensaje usuario": {
      "main": [
        [
          {
            "node": "GIA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "d5c24d8e-91f9-4307-8cc5-61dade70df28",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "a1e37b5e27d5beb906ef8ca290918f3229c81f2df4498f1cd9643640814e1921"
  },
  "id": "K6IJLQdbaguUJ8Qm",
  "tags": []
}